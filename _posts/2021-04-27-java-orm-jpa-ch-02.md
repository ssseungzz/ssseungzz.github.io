---
title: "JPA 뽀개기 - JPA 시작"
categories:
  - Develop
tags:
  - jpa
  - java
toc: true
toc_label: "Contents"
toc_sticky: true
---

### 2. JPA 시작

* JPA를 사용하기 위해 클래스와 테이블을 매핑(테이블의 컬럼과 객체의 필드를 매핑)

* 매핑 어노테이션 사용

  * `@Entity`: 이 클래스를 테이블과 매핑한다고 JPA에게 알려 준다. 이 어노테이션이 붙은 클래스를 엔티티 클래스라고 한다.
  * `@Table`: 엔티티 클래스에 매핑할 테이블 정보를 알려 준다. 생략하면 크래스 이름을 테이블 이름으로 매핑한다.
  * `@Id`: 엔티티 클래스의 필드를 테이블의 기본 키에 매핑한다. 이 어노테이션이 사용된 필드를 식별자 필드라고 한다.
  * `@Column`: 필드를 컬럼에 매핑한다.
  * 매핑 어노테이션이 없는 필드는 필드명을 사용해서 컬럼명으로 매핑한다.

* JPA 설정

  * `persistence.yml` 을 사용해서 설정 정보를 관리한다고 되어 있는데, 스프링에서 JPA를 사용하는 경우 대부분 Spring Data JPA를 사용하고 이에 대한 설정은 `yml` 파일로 가능하다.

    > 참고) JPA, Hibernate, Spring Data JPA의 관계

    ![](https://suhwan.dev/images/jpa_hibernate_repository/overall_design.png)

  * JPA는 특정 데이터베이스에 종속적이지 않은 기술이다. 다른 데이터베이스로 바꿀 때의 편의를 위해 대부분의 JPA 구현체들은 특정 데이터베이스만의 고유한 기능(방언; dialect) 클래스를 제공한다.

* 객체 매핑을 완료하고 JPA 설정도 완료하면 애플리케이션 개발이 가능해진다. 크게 세 부분으로 나뉜다.

##### 엔티티 매니저 설정

* 설정 파일에서 영속성 유닛 설정을 찾아 엔티티 매니저 팩토리를 생성한다. 설정 정보를 읽어 JPA를 동작시키기 위한 기반 객체를 만들고 JPA 구현체에 따라 데이터베이스 커넥션 풀도 생성하므로 엔티티 매니저 팩토리 생성 비용은 매우 크다. 따라서 **애플리케이션 전체에서 한 번만 생성하고 공유해서 사용**해야 한다.
* 엔티티 매니저 팩토리에서 엔티티 매니저를 생성한다. 대부분의 기능은 엔티티 매니저가 제공한다. 데이터베이스 커넥션과 밀접한 관계가 있으므로 스레드 간 공유하거나 재사용하면 안 된다.

##### 트랜잭션 관리

* JPA를 사용하면 항상 트랜잭션 안에서 데이터를 변경해야 한다. 

##### 비즈니스 로직

* 엔티티 매니저를 통해 객체를 데이터베이스에 등록, 수정, 삭제, 조회한다. 
  * 저장을 위해 엔티티 매니저의 `persist()` 메소드에 저장할 엔티티를 넘겨준다. JPA는 회원 엔티티의 매핑 정보를 분석해서 SQL를 생성한 후 데이터베이스에 전달한다.
  * 수정은 엔티티를 수정하기만 하면 된다. JPA는 어떤 엔티티가 변경되었는지 추적하는 기능을 갖추고 있다.
  * 삭제는 엔티티 매니저의 `remove()` 메소드를 통해 가능하다.
  * 엔티티 매니저에서 메소드를 호출하면 SELECT SQL을 생성한다.

* JPA는 검색할 때도 엔티티 객체를 대상으로 검색해야 하는데, 이를 위해서는 데이터베이스의 모든 데이터를 애플리케이션으로 불러와서 엔티티 객체로 변환한 다음 검색해야 한다. 이는 불가능하므로 애플리케이션이 필요한 데이터만 데이터베이스에 불러오려면 결국 검색 조건이 포함된 SQL을 사용해야 한다. 
  * JPA는 JPQL(Java Persistence Query Language)이라는 쿼리 언어로 이런 문제를 해결한다.
  * JPQL은 SQL과 문법이 거의 유사하나 **엔티티 객체** 를 대상으로 쿼리한다(SQL은 데이터베이스 테이블 대상)는 차이점이 있다. JPQL은 데이터베이스 테이블을 전혀 알지 못한다.
  * JPQL을 사용하려면 `em.createQuery(JPQL, 반환 타입)` 메소드를 실행해서 쿼리 객체를 생성한 후 쿼리 객체의 `getResultList()` 메소드를 호출하면 된다. 