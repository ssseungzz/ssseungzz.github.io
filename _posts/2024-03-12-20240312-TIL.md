---
title: "2024 년 3 월 12 일 TIL"
categories:
  - TIL
tags:
toc: true
toc_label: "Contents"
toc_sticky: true

---

#### 오늘 한 일

* 기존 캐시 개선 데이터 구조 설계 ing...
* 이펙티브 자바 아이템 82(스레드 안전성 수준을 문서화하라) 읽기
  * 모든 클래스가 자신의 스레드 안전성 정보를 명확히 문서화해야 한다. 언어로 명확히 설명하거나 스레드 안전성 애너테이션을 사용 가능하다. `synchronized` 한정자는 문서화와 관련이 없다. 조건부 스레드 안전 클래스는 메서드를 어떤 순서로 호출할 때 외부 동기화가 요구되고, 그때 어떤 락을 얻어야 하는지도 알려 줘야 한다. 무조건적 스레드 안전 클래스를 작성할 때는 `synchronized` 메서드가 아닌 비공개 락 객체를 사용하자.
* 이펙티브 자바 아이템 83(지연 초기화는 신중히 사용하라) 읽기
  * 대부분의 필드는 지연시키지 말고 곧바로 초기화해야 한다. 성능 때문에 혹은 위험한 초기화 순환을 막기 위해 꼭 지연 초기화를 써야 한다면 올바른 지연 초기화 기법을 사용하자. 인스턴스 필드에는 이중검사 관용구를, 장적 필드에는 지연 초기화 홀더 클래스 관용구를 사용하자. 반복해 초기화해도 괜찮은 인스턴스 필드에는 단일검사 관용구도 고려 대상이다.





#### 느낀 점

* 레디스 `scan` 이 성능이 생각보다 좋지 않다는 사실을 알았다. 그래서 패턴 검색을 최대한 덜 쓰도록 캐시 데이터 구조를 바꾸고 싶은데, 문제는 원하는 데이터를 얻으려면 상황에 따라 패턴 검색이 필요할 수 있다는 것이다. 패턴 검색을 하지 않도록 하려면 여기저기에 중복되는 데이터를 들고 있어야 한다. 심지어 사용하는 쪽의 구현이 아직 덜 되어 패턴 검색이 필요한 경우가 많이 사용되는지, 그렇지 않은 경우가 많이 사용되는지도 알 수 없다...... 이럴 땐 어떡하면 좋을까? 약간의 중복을 감수해야 할까?