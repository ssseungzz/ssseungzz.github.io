---
title: "2023 년 12 월 20 일 TIL"
categories:
  - TIL
tags:
toc: true
toc_label: "Contents"
toc_sticky: true
---

#### 오늘 한 일

* 여전히 캐시를 hazelcast에서 redis로 변환하면서 캐시 엔티티를 조금 더 효율적인 구조로 바꾸기 위해 고민 중이다. 키와 엔티티 필드는 결정했는데 데이터 보정 시에 배치를 사용할지, 키 만료 이벤트를 받을지 고민이 된다.




#### 느낀 점

* 완전히 캐시 장비를 전환하기 전까지 두 캐시 저장소 모두 사용할 수 있어야 하는데, 배치를 사용하는 경우에 추상화가 약간 더 복잡해진다. 그렇다고 이벤트를 받자니 헤이즐캐스트는 간단히 구현 가능한데 레디스는 설정이 조금 더 복잡해진다. 레디스에서 키 만료 이벤트 전송 옵션을 켜고 만료 이벤트를 받아야 하는 키만 이벤트를 받고 싶은데, 이게 애플리케이션 레벨에서 설정이 가능한 부분인지 확인이 필요하다. 모든 TTL 걸린 캐시에 대해서 이벤트가 오면 오버헤드가 너무 커질 것 같으니까... 
* 애당초 이 캐시가 필요한 이유가 이 캐시를 사용하는 기능은 우리 서비스 내부 기능이라기보다는 우리 서비스는 중개만 하는 입장이라, 실제 서비스하는 곳에서 콜백이 제대로 도달하지 못했을 때 조금 나중에라도 정확한 정보를 업데이트하기 위함인데, 실제 서비스하는 곳에서 재시도 로직을 추가해 주는 게 낫지 않나 싶다. 그런데 재시도 로직도 모두 실패하는 상황이면 우리로서는 어떻게 할 방법이 없다. 이런 경우는 정말 큰 장애 상황 아니면 발생하지 않을 텐데, 그래도 재시도 로직 이상의 대비책이 필요한 걸까?
  * 일단 필요하다고 가정하고 진행 중이기는 하다. 별개로 레디스에서 이벤트를 안 줘서 이것도 내일 더 확인해 봐야 함. TT  